========================================
  Gemini API 代理配置说明
========================================

如果遇到 "User location is not supported" 错误，请按以下步骤操作：

方法1：使用 Clash 代理（推荐）
----------------------------------------
1. 确保 Clash 或 FlClash 已启动
2. 打开 Clash 控制面板（通常是 http://127.0.0.1:9090）
3. 将【规则模式】改为【全局模式 (Global)】
   ⚠️ 重要：必须是全局模式，规则模式可能无法完全代理
4. 确认代理端口是 7890（默认端口）
5. 重启服务器

方法2：检查代理是否生效
----------------------------------------
1. 打开浏览器访问：http://ip-api.com/json/
2. 查看返回的 "country" 字段
3. 如果显示 "China"，说明代理未生效
4. 如果显示其他国家（如 "United States"），说明代理正常

方法3：手动测试代理
----------------------------------------
在命令行运行：
  python -c "import requests; print(requests.get('http://ip-api.com/json/', proxies={'http':'http://127.0.0.1:7890','https':'http://127.0.0.1:7890'}).json())"

如果返回的国家不是 China，说明代理正常。

方法4：修改代理端口
----------------------------------------
如果您的代理端口不是 7890，需要修改代码：

1. 打开 backend/app.py
2. 找到所有 "127.0.0.1:7890" 
3. 替换为您的代理端口，例如 "127.0.0.1:10808"

方法5：使用系统代理
----------------------------------------
如果您的系统已设置全局代理，可以尝试：
1. 在 Windows 设置中配置系统代理
2. 确保代理地址和端口正确
3. 代码会自动使用系统代理

========================================
  常见问题
========================================

Q: 为什么设置了代理还是报错？
A: 可能原因：
   1. 代理未设置为全局模式（规则模式可能漏掉某些请求）
   2. 代理IP本身在受限地区
   3. Gemini API 可能通过其他方式检测位置（如API Key注册地区）

Q: 如何确认代理已生效？
A: 服务器启动时会显示：
   [PROXY] 代理检测: IP=xxx.xxx.xxx.xxx, 国家=United States
   如果国家不是 China，说明代理正常

Q: 代理端口在哪里修改？
A: 在 backend/app.py 文件中，搜索 "127.0.0.1:7890" 并替换为您的端口

Q: 可以使用 VPN 吗？
A: 可以，但需要确保：
   1. VPN 设置为全局模式
   2. VPN 的本地代理端口正确配置
   3. 或者使用系统级 VPN（TUN模式）

========================================
  临时解决方案
================================--------

如果代理问题无法解决，可以考虑：

1. 使用其他 AI 服务（如 OpenAI、Claude 等）
2. 使用国内可用的 AI API
3. 手动分析商品数据（不使用 AI）

========================================


